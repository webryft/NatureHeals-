<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nature Heals ‚Äî Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
:root{
  --bg:#f6fff6; --card:#fff; --accent:#16a34a; --muted:#163925;
}
body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--muted);padding:22px;}
.hidden{display:none}
.wrap{max-width:1100px;margin:0 auto}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
h1{margin:0;font-size:20px}
.grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(9,30,15,0.04)}
label{display:block;margin-top:10px;font-weight:700;color:#163925}
input[type="text"],input[type="number"],input[type="file"],input[type="password"]{width:100%;padding:10px;border-radius:10px;border:1px solid #e7efe8;margin-top:6px}
button{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer;font-weight:700}
button.ghost{background:#fff;color:var(--muted);border:1px solid #e7efe8}
button.red{background:#ef4444}
.muted{color:#66756a;font-size:13px;margin-top:8px}
.list{margin-top:12px;max-height:560px;overflow:auto}
.item{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid #eef6ef}
.thumb{width:84px;height:64px;object-fit:cover;border-radius:8px;border:1px solid #eef6ef}
.itemTitle{font-weight:800}
.small{font-size:13px;color:#6b8b7a}
.empty{padding:18px;color:#6b8b7a;text-align:center}
.loginBox{max-width:360px;margin:120px auto;background:white;padding:24px;border-radius:12px;box-shadow:0 8px 40px rgba(0,0,0,0.08)}
.loginBox h2{text-align:center;margin-bottom:16px;color:var(--muted)}
.passwordField{display:flex;align-items:center}
.passwordField input{flex:1;border-right:0;border-radius:10px 0 0 10px;}
.passwordField button{border-radius:0 10px 10px 0;padding:10px;background:#eee;color:#333;font-weight:600;border:none;cursor:pointer}
@media(max-width:900px){.grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="loginBox">
  <h2>Admin Login</h2>
  <div class="passwordField">
    <input id="adminPass" type="password" placeholder="Enter password">
    <button id="togglePass">üëÅ</button>
  </div>
  <button id="loginBtn" style="margin-top:14px;width:100%">Login</button>
</div>

<!-- Main Admin Interface -->
<div id="adminApp" class="wrap hidden">
  <header>
    <h1>Nature Heals ‚Äî Admin Panel</h1>
    <div class="toolbar">
      <button id="refreshBtn" class="ghost">Refresh</button>
      <button id="logoutBtn" class="ghost">Logout</button>
    </div>
  </header>

  <div class="grid">
    <div class="card">
      <h2>Add Product</h2>
      <label>Picture name</label>
      <input id="prodName" type="text" placeholder="Misty Forest">
      <label>Price (NGN)</label>
      <input id="prodPrice" type="number" placeholder="1200">
      <label>Picture file</label>
      <input id="prodImage" type="file" accept="image/*">
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="addProd">Add Product</button>
        <button id="clearForm" class="ghost">Clear</button>
      </div>
    </div>

    <div class="card">
      <h2>Products (Live)</h2>
      <div id="prodList" class="list"><div class="empty">Loading...</div></div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhnK7DGb9guxUSjkWWH6s7jT7-NU0oBdM",
  authDomain: "nature-heals-4f4db.firebaseapp.com",
  projectId: "nature-heals-4f4db",
  storageBucket: "nature-heals-4f4db.appspot.com",
  messagingSenderId: "945050051317",
  appId: "1:945050051317:web:8da40b136b6e6b794c9bbc",
  measurementId: "G-FYJ6SBDQN7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const loginScreen = document.getElementById("loginScreen");
const adminApp = document.getElementById("adminApp");
const loginBtn = document.getElementById("loginBtn");
const togglePass = document.getElementById("togglePass");
const adminPass = document.getElementById("adminPass");
const logoutBtn = document.getElementById("logoutBtn");
const prodList = document.getElementById('prodList');
const addProdBtn = document.getElementById('addProd');
const prodNameEl = document.getElementById('prodName');
const prodPriceEl = document.getElementById('prodPrice');
const prodImageEl = document.getElementById('prodImage');
const refreshBtn = document.getElementById('refreshBtn');
const clearForm = document.getElementById('clearForm');

togglePass.addEventListener("click",()=>{
  adminPass.type = adminPass.type === "password" ? "text" : "password";
  togglePass.textContent = adminPass.type === "password" ? "üëÅ" : "üôà";
});

loginBtn.addEventListener("click",()=>{
  const pass = adminPass.value.trim();
  if(pass === "242777Aa#"){
    loginScreen.classList.add("hidden");
    adminApp.classList.remove("hidden");
    startListener();
    Swal.fire({title:"Welcome Admin üåø",icon:"success",timer:1500,showConfirmButton:false});
  }else{
    Swal.fire({title:"Incorrect password",icon:"error"});
  }
});

logoutBtn.addEventListener("click",()=>{
  adminApp.classList.add("hidden");
  loginScreen.classList.remove("hidden");
  adminPass.value="";
});

function toast(msg,icon='success'){
  Swal.fire({toast:true,position:'top-end',title:msg,icon,showConfirmButton:false,timer:2000});
}

function renderItem(id,p){
  const div=document.createElement('div');
  div.className='item';
  div.innerHTML=`
    <img class="thumb" src="${p.imageURL}">
    <div style="flex:1">
      <div class="itemTitle">${p.name}</div>
      <div class="small">‚Ç¶${Number(p.price).toFixed(2)}</div>
    </div>
    <button class="red removeBtn" data-id="${id}">Remove</button>`;
  return div;
}

function startListener(){
  prodList.innerHTML='<div class="empty">Loading...</div>';
  onSnapshot(collection(db,'products'),snap=>{
    prodList.innerHTML='';
    if(snap.empty){
      prodList.innerHTML='<div class="empty">No products yet.</div>';
      return;
    }
    snap.forEach(d=>prodList.appendChild(renderItem(d.id,d.data())));
  },err=>{
    console.error(err);
    prodList.innerHTML='<div class="empty">Error loading products</div>';
  });
}

addProdBtn.addEventListener('click',async()=>{
  const name=prodNameEl.value.trim();
  const price=Number(prodPriceEl.value)||0;
  const file=prodImageEl.files[0];
  if(!name||!file){Swal.fire("Missing info","Enter name & choose image","warning");return;}
  try{
    const path=`products/${Date.now()}_${file.name}`;
    const refFile=ref(storage,path);
    await uploadBytes(refFile,file);
    const url=await getDownloadURL(refFile);
    await addDoc(collection(db,'products'),{name,price,imageURL:url,createdAt:Date.now()});
    toast('Product added üåø');
    prodNameEl.value='';prodPriceEl.value='';prodImageEl.value='';
  }catch(e){console.error(e);Swal.fire("Upload failed","Check console","error");}
});

prodList.addEventListener('click',async e=>{
  if(e.target.classList.contains('removeBtn')){
    const id=e.target.dataset.id;
    const res=await Swal.fire({title:"Remove this product?",icon:"warning",showCancelButton:true});
    if(!res.isConfirmed)return;
    await deleteDoc(doc(db,'products',id));
    toast('Removed');
  }
});

refreshBtn.addEventListener('click',()=>startListener());
clearForm.addEventListener('click',()=>{prodNameEl.value='';prodPriceEl.value='';prodImageEl.value='';});
</script>
</body>
</html>

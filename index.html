<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nature Heals â€” Gallery</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#ffebef;
    --accent:#d63384;
    --muted:#6b2d4b;
    --card:#fff4f9;
  }
  body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--accent);}
  header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#ffb6c1;flex-wrap:wrap;}
  .menuBtn{cursor:pointer;font-size:20px;padding:6px}
  .title{font-weight:800;font-size:14px}
  .searchWrap{display:flex;align-items:center;background:#fff;border-radius:14px;padding:6px 8px;flex:1;max-width:320px}
  .searchWrap input{border:none;outline:none;width:100%}
  .menuRight{display:flex;align-items:center;gap:8px}
  .profile{width:36px;height:36px;border-radius:50%;object-fit:cover;cursor:pointer}
  .cart{position:relative;cursor:pointer}
  .cart span{position:absolute;top:-5px;right:-5px;background:red;color:white;font-size:11px;border-radius:10px;padding:0 4px}

  .hero{margin:12px;border-radius:12px;overflow:hidden;height:280px;position:relative}
  .hero img{width:100%;height:100%;object-fit:cover;display:block}
  .overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;background:rgba(0,0,0,0.2);color:white;}
  .overlay h1{margin:0;font-size:20px;font-weight:900}

  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;padding:18px}
  .card{background:var(--card);padding:10px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}
  .card img{width:100%;height:260px;object-fit:cover;border-radius:8px}
  .card h3{margin:8px 0 4px;font-size:15px}
  .price{font-weight:800}
  .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .add{background:#fff}
  .buy{background:linear-gradient(90deg,#34d399,#10b981);color:white}

  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:999;align-items:center;justify-content:center}
  .modalCard{background:white;padding:20px;border-radius:12px;max-width:400px;width:90%}

  audio{display:none}
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:6px;">
    <div class="menuBtn" id="menuBtn">â˜°</div>
    <div class="title">Nature Heals</div>
  </div>
  <div class="searchWrap"><input id="search" placeholder="Search..." /></div>
  <div class="menuRight">
    <img id="profilePic" class="profile" src="image22.jpg" alt="profile">
    <div class="cart" id="cartBtn">ðŸ›’<span id="cartCount">0</span></div>
  </div>
</header>

<div class="hero">
  <img id="coverImg" src="" alt="Cover">
  <div class="overlay">
    <h1>Nature Heals ðŸŒ¿</h1>
    <p>Relax. Refresh. Reconnect with nature.</p>
  </div>
</div>

<div class="grid" id="gallery"></div>

<!-- Auth Modal -->
<div class="modal" id="authModal">
  <div class="modalCard">
    <h3 id="authTitle">Sign In</h3>
    <input id="email" placeholder="Email" style="width:100%;padding:8px;margin:6px 0">
    <input id="password" type="password" placeholder="Password" style="width:100%;padding:8px;margin:6px 0">
    <button id="authAction" class="btn buy" style="width:100%">Continue</button>
    <div style="text-align:center;margin-top:10px;">
      <a href="#" id="toggleAuth">Create Account</a>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, setDoc, doc, query, where, getDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhnK7DGb9guxUSjkWWH6s7jT7-NU0oBdM",
  authDomain: "nature-heals-4f4db.firebaseapp.com",
  projectId: "nature-heals-4f4db",
  storageBucket: "nature-heals-4f4db.firebasestorage.app",
  messagingSenderId: "945050051317",
  appId: "1:945050051317:web:8da40b136b6e6b794c9bbc",
  measurementId: "G-FYJ6SBDQN7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);
const auth = getAuth(app);

const gallery = document.getElementById("gallery");
const search = document.getElementById("search");
const coverImg = document.getElementById("coverImg");
const profilePic = document.getElementById("profilePic");
const authModal = document.getElementById("authModal");
const authTitle = document.getElementById("authTitle");
const authAction = document.getElementById("authAction");
const toggleAuth = document.getElementById("toggleAuth");
let creating = false;
let userEmail = null;

async function loadCover(){
  try{
    const url = await getDownloadURL(ref(storage, 'cover/cover.gif'));
    coverImg.src = url;
  }catch(e){ console.log('No cover yet'); }
}

async function loadAudio(){
  try{
    const url = await getDownloadURL(ref(storage, 'audio/background.mp3'));
    const audio = new Audio(url);
    audio.loop = true;
    audio.play().catch(()=>{});
  }catch(e){ console.log('No audio yet'); }
}

async function loadGallery(){
  gallery.innerHTML = '<div>Loading...</div>';
  const snap = await getDocs(collection(db, "products"));
  let html = '';
  snap.forEach(doc=>{
    const p = doc.data();
    html += `
      <div class="card">
        <img src="${p.imageURL}" alt="${p.name}">
        <h3>${p.name}</h3>
        <div class="price">â‚¦${p.price}</div>
        <div style="margin-top:6px;display:flex;gap:8px;">
          <button class="btn add" data-id="${doc.id}" data-name="${p.name}">Add to Cart</button>
          <button class="btn buy" data-id="${doc.id}" data-name="${p.name}">Buy Now</button>
        </div>
      </div>`;
  });
  gallery.innerHTML = html || '<div>No products yet.</div>';
}

search.addEventListener("input", ()=>{
  const val = search.value.toLowerCase();
  document.querySelectorAll(".card").forEach(c=>{
    c.style.display = c.textContent.toLowerCase().includes(val)?'block':'none';
  });
});

// Auth handling
document.getElementById("menuBtn").onclick = ()=> authModal.style.display='flex';
toggleAuth.onclick = (e)=>{
  e.preventDefault();
  creating = !creating;
  authTitle.textContent = creating ? "Create Account" : "Sign In";
  toggleAuth.textContent = creating ? "Have an account? Sign in" : "Create Account";
};
authAction.onclick = async ()=>{
  const email = document.getElementById("email").value;
  const pw = document.getElementById("password").value;
  try{
    if(creating){
      await createUserWithEmailAndPassword(auth, email, pw);
    } else {
      await signInWithEmailAndPassword(auth, email, pw);
    }
    authModal.style.display='none';
  }catch(e){ alert(e.message); }
};

onAuthStateChanged(auth, (user)=>{
  if(user){ userEmail=user.email; profilePic.title=user.email; }
  else { userEmail=null; }
});

// Cart (Firestore per-user)
const cartBtn = document.getElementById("cartBtn");
const cartCount = document.getElementById("cartCount");
let cart = [];

async function saveCart(){
  if(!userEmail){ alert("Please sign in"); return; }
  await setDoc(doc(db,"carts",userEmail),{items:cart});
  cartCount.textContent = cart.length;
}

document.body.addEventListener("click", async(e)=>{
  if(e.target.classList.contains("add")){
    const name=e.target.dataset.name;
    cart.push(name);
    await saveCart();
    alert(name+" added to cart");
  }
  if(e.target.classList.contains("buy")){
    const name=e.target.dataset.name;
    const msg = encodeURIComponent(`Hello Nature Heals, I want to buy ${name}. My email: ${userEmail||'guest@example.com'}`);
    window.open(`https://wa.me/09032292949?text=${msg}`,'_blank');
  }
});

// Init
loadCover();
loadAudio();
loadGallery();
</script>
</body>
</html>

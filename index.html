<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nature Heals ‚Äî Gallery</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap" rel="stylesheet">

<!-- ‚úÖ SweetAlert2 for professional popups -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  :root{
    --bg:#f6fff6;
    --accent:#2f855a;
    --muted:#234e3a;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--muted)}
  header{display:flex;align-items:center;gap:10px;padding:10px 14px;background:#e6fff1;flex-wrap:wrap;position:sticky;top:0;z-index:50;border-bottom:1px solid rgba(0,0,0,0.04)}
  .left{display:flex;align-items:center;gap:8px;min-width:0}
  .menuBtn{cursor:pointer;font-size:20px;padding:6px}
  .title{font-weight:800;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .searchWrap{display:flex;align-items:center;background:#fff;border-radius:14px;padding:6px 8px;flex:1;max-width:520px}
  .searchWrap input{border:none;outline:none;width:100%;font-size:14px;padding:6px}
  .menuRight{display:flex;align-items:center;gap:10px;margin-left:auto}
  .flag{font-size:18px;cursor:pointer}
  .profile-pic{width:36px;height:36px;border-radius:50%;object-fit:cover;cursor:pointer;border:2px solid rgba(0,0,0,0.04)}
  .cart{position:relative;cursor:pointer;font-weight:900;font-size:18px}
  .cartBadge{position:absolute;top:-6px;right:-10px;background:red;color:white;border-radius:10px;padding:2px 6px;font-size:12px}

  /* Hero */
  .hero{margin:12px;border-radius:12px;overflow:hidden;border:1px solid rgba(0,0,0,0.04);position:relative;height:360px;background:#dff6e9}
  .hero img{width:100%;height:100%;object-fit:cover;display:block}
  .heroOverlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;text-align:center;color:#fff;background:linear-gradient(180deg,rgba(0,0,0,0.15),rgba(0,0,0,0.25))}
  .heroOverlay h1{margin:0;font-size:26px;font-weight:900}
  .heroOverlay p{margin-top:8px;font-size:14px}

  /* Grid for A4 items (3 per row) */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;padding:18px;max-width:1200px;margin:0 auto}
  .card{background:var(--card);padding:10px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.05)}
  .card img{width:100%;height:360px;object-fit:cover;border-radius:8px}
  .card h3{margin:8px 0 4px;font-size:16px;color:var(--muted)}
  .priceRow{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
  .buy{background:linear-gradient(90deg,#34d399,#10b981);color:white}
  .add{background:#fff;border:1px solid rgba(0,0,0,0.06)}

  /* Modals */
  .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:999;align-items:center;justify-content:center;padding:20px}
  .modal{background:white;border-radius:12px;padding:18px;max-width:420px;width:100%}
  .modal h3{margin:0 0 8px}

  /* small screens */
  @media (max-width:720px){
    .hero{height:200px}
    .card img{height:220px}
    .searchWrap{max-width:200px}
  }
      
</style>
</head>
<body>

<header>
  <div class="left">
    <div id="menuBtn" class="menuBtn" title="Menu">‚ò∞</div>
    <div class="title">Nature Heals</div>
    <div class="searchWrap" title="Search pictures">
      <input id="searchInput" placeholder="Search product by name..." />
      <div style="margin-left:8px">üîç</div>
    </div>
  </div>

  <div class="menuRight">
    <!-- country flag; replace the small list with full list if you want -->
    <div id="countryBtn" style="display:flex;align-items:center;gap:6px;cursor:pointer">
      <span id="selectedFlag" class="flag">üá≥üá¨</span>
      <span id="selectedCountry" style="font-size:13px">Nigeria</span>
    </div>

    <img id="profileImg" class="profile-pic" src="image22.jpg" alt="Profile" title="Profile">
    <div id="cartBtn" class="cart">üõí <span class="cartBadge" id="cartCount">0</span></div>
  </div>
</header>

<!-- HERO using local asset -->
<div class="hero">
  <img id="coverImg" src="cover.gif" alt="Cover">
  <div class="heroOverlay">
    <h1>Nature Heals</h1>
    <p>Calming prints ‚Äî bring nature into your home.</p>
  </div>
</div>

<!-- Products grid -->
<div class="grid" id="productGrid">
  <!-- items injected by JS -->
</div>

<!-- Hidden audio (invisible to users) -->
<audio id="bgAudio" autoplay loop>
  <source src="audio.mp3" type="audio/mpeg">
</audio>

<!-- Menu Modal -->
<div id="menuModal" class="overlay">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Menu</strong> <button id="closeMenu" class="btn">‚úï</button>
    </div>

    <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
      <button id="openSignUp" class="btn">Sign up</button>
      <button id="openSignIn" class="btn">Sign in</button>
      <button id="openAbout" class="btn">About</button>
      <button id="openSettings" class="btn">Settings</button>
      <button id="openContact" class="btn">Contact us</button>
    </div>
  </div>
</div>

<!-- SignUp Modal (localStorage-based) -->
<div id="signupModal" class="overlay">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Sign up</strong> <button class="btn closeModal">‚úï</button>
    </div>

    <div style="margin-top:12px">
      <label>Profile picture</label>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <img id="signupPreview" src="" style="width:64;height:64;border-radius:50%;object-fit:cover;display:none">
        <button id="pickProfile" class="btn">Choose picture</button>
        <input id="profileFile" type="file" accept="image/*" style="display:none">
      </div>

      <input id="signupUsername" placeholder="Username" style="width:100%;padding:8px;margin-top:8px">
      <input id="signupEmail" placeholder="Email" type="email" style="width:100%;padding:8px;margin-top:8px">
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="signupPassword" placeholder="Password" type="password" style="flex:1;padding:8px">
        <button id="toggleSignupPass" class="btn">Show</button>
      </div>
      <input id="signupPet" placeholder="Pet name (for recovery)" style="width:100%;padding:8px;margin-top:8px">

      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="doSignup" class="btn primary">Create account</button>
        <button id="cancelSignup" class="btn">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- SignIn Modal -->
<div id="signinModal" class="overlay">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Sign in</strong> <button class="btn closeModal">‚úï</button>
    </div>
    <div style="margin-top:12px">
      <input id="signinEmail" placeholder="Email" type="email" style="width:100%;padding:8px;margin-top:8px">
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="signinPassword" placeholder="Password" type="password" style="flex:1;padding:8px">
        <button id="toggleSigninPass" class="btn">Show</button>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <button id="doSignin" class="btn primary">Sign in</button>
        <button id="forgotPass" class="btn">Forgot password?</button>
      </div>
    </div>
  </div>
</div>

<!-- Forgot flow -->
<div id="forgotModal" class="overlay">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Forgot password</strong> <button class="btn closeModal">‚úï</button>
    </div>
    <div style="margin-top:12px">
      <div>What is your pet name?</div>
      <input id="petNameInput" placeholder="Pet name" style="width:100%;padding:8px;margin-top:8px">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="submitPet" class="btn buy">Submit</button>
        <button id="cancelPet" class="btn">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Password change -->
<div id="pwChangeModal" class="overlay">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Reset password</strong> <button class="btn closeModal">‚úï</button>
    </div>
    <div style="margin-top:12px">
      <input id="newPassword" placeholder="New password" type="password" style="width:100%;padding:8px;">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="doChangePw" class="btn buy">Submit</button>
        <button id="cancelChangePw" class="btn">Cancel</button>
      </div>
      <div id="pwMsg" style="margin-top:10px;font-weight:700"></div>
    </div>
  </div>
</div>

<!-- Country modal -->
<div id="countryModal" class="overlay">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Select country</strong> <button class="btn closeModal">‚úï</button>
    </div>
    <div style="margin-top:10px">
      <input id="countrySearch" placeholder="Search country..." style="width:100%;padding:8px">
      <div id="countryList" style="max-height:60vh;overflow:auto;margin-top:8px"></div>
    </div>
  </div>
</div>

<!-- Cart modal -->
<div id="cartModal" class="overlay">
  <div class="modal" style="max-width:720px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Your Cart</strong> <button class="btn closeModal">‚úï</button>
    </div>
    <div id="cartItems" style="margin-top:10px;max-height:60vh;overflow:auto"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="checkoutBtn" class="btn buy">Checkout (WhatsApp)</button>
      <button id="clearCart" class="btn">Clear cart</button>
    </div>
  </div>
</div>

<!-- Firebase + app logic -->
<script type="module">
/* ========== Firebase setup (read-only for index) ========== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, addDoc, doc, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";

/* Your Firebase config (you provided this) */
const firebaseConfig = {
  apiKey: "AIzaSyDhnK7DGb9guxUSjkWWH6s7jT7-NU0oBdM",
  authDomain: "nature-heals-4f4db.firebaseapp.com",
  projectId: "nature-heals-4f4db",
  storageBucket: "nature-heals-4f4db.appspot.com",  // ‚úÖ Correct this line
  messagingSenderId: "945050051317",
  appId: "1:945050051317:web:8da40b136b6e6b794c9bbc",
  measurementId: "G-FYJ6SBDQN7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

/* ========== DOM refs ========== */
const productGrid = document.getElementById('productGrid');
const cartCountEl = document.getElementById('cartCount');
const profileImgEl = document.getElementById('profileImg');
const searchInput = document.getElementById('searchInput');
const coverImg = document.getElementById('coverImg');

/* ========== LocalStorage keys ========== */
const LS_USER = 'NH_USER_v1';
const LS_CART = 'NH_CART_v1';
const LS_COUNTRY = 'NH_COUNTRY_v1';

/* ========== Utilities & popup helpers ========== */
const $ = id => document.getElementById(id);
function uid(){ return 'id'+Math.random().toString(36).slice(2,9); }

/* SweetAlert2 helpers (inserted: replacements for alert) */
function showToast(msg, icon="success"){
  Swal.fire({
    toast:true,
    position:'top-end',
    icon:icon,
    title: msg,
    showConfirmButton:false,
    timer:2500,
    timerProgressBar:true,
    background: '#ffffff',
    color: '#064E3B'
  });
}
function showPopup(title, text, icon="info"){
  Swal.fire({
    title: title,
    text: text,
    icon: icon,
    confirmButtonColor:"#16a34a"
  });
}

/* ========== Init: load cover asset already uses cover.gif (local file) ==========
   Note: asset files should live in the same folder as index.html: cover.gif and audio.mp3
*/
(async function initCoverAndAudio(){
  // nothing required here: cover and audio are loaded via markup.
})();

/* ========== Load products in realtime from Firestore ========== */
function renderProducts(snapshotDocs){
  productGrid.innerHTML = '';
  snapshotDocs.forEach(d=>{
    const p = d.data; // d.data is already an object from Firestore
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.imageURL}" alt="${p.name}">
      <h3>${p.name}</h3>
      <div class="priceRow">
        <div style="font-weight:800">‚Ç¶${Number(p.price).toFixed(2)}</div>
        <div style="display:flex;gap:8px">
          <button class="btn add" data-id="${d.id}" data-name="${p.name}" data-price="${p.price}">Add to cart</button>
          <button class="btn buy" data-id="${d.id}" data-name="${p.name}">Buy now</button>
        </div>
      </div>`;
    productGrid.appendChild(card);
  });

  // If no items at all
  if (snapshotDocs.length === 0) {
    productGrid.innerHTML = '<div style="text-align:center;color:#666;padding:20px;">No products available yet üå±</div>';
  }
}


/* subscribe to products collection */
const productsSnapshot = [];
onSnapshot(collection(db, 'products'), snap => {
  console.log("Products snapshot received:", snap.size);
  ...
});
  

  // store snapshot for search/filter
  productsSnapshot.length = 0; productsSnapshot.push(...docs);
  renderProducts(docs);
  applySearch();
  
});

/* ========== Search ========== */
function applySearch(){
  const q = (searchInput.value || '').trim().toLowerCase();
  if(!q){ document.querySelectorAll('.card').forEach(c=>c.style.display='block'); return; }
  document.querySelectorAll('.card').forEach(card=>{
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(q) ? 'block' : 'none';
  });
}
searchInput.addEventListener('input', applySearch);

/* ========== Local user and cart handling ========== */
let currentUser = JSON.parse(localStorage.getItem(LS_USER) || 'null');
let cart = JSON.parse(localStorage.getItem(LS_CART) || '[]');

function saveUser(){ localStorage.setItem(LS_USER, JSON.stringify(currentUser)); }
function saveCart(){ localStorage.setItem(LS_CART, JSON.stringify(cart)); updateCartUI(); }

function updateCartUI(){ cartCountEl.textContent = cart.length || 0; }

updateCartUI();
if(currentUser && currentUser.profilePicDataURL) profileImgEl.src = currentUser.profilePicDataURL;

/* Profile picture change (stays in localStorage even after logout) */
profileImgEl.addEventListener('click', ()=>{
  const f = document.createElement('input'); f.type='file'; f.accept='image/*';
  f.onchange = e=>{
    const file = e.target.files[0]; if(!file) return;
    const r = new FileReader();
    r.onload = ()=> {
      const data = r.result;
      profileImgEl.src = data;
      currentUser = currentUser || {};
      currentUser.profilePicDataURL = data;
      saveUser();
      // ‚úÖ replaced alert with toast
      showToast('Profile picture updated locally üåø', 'success');
    };
    r.readAsDataURL(file);
  };
  f.click();
});

/* ========== Menu interactions & modals ========== */
const menuModal = $('menuModal');
$('menuBtn').addEventListener('click', ()=> menuModal.style.display='flex');
$('closeMenu').addEventListener('click', ()=> menuModal.style.display='none');

/* open sign up / in */
$('openSignUp').addEventListener('click', ()=>{
  menuModal.style.display='none';
  $('signupModal').style.display='flex';
});
$('openSignIn').addEventListener('click', ()=>{
  menuModal.style.display='none';
  $('signinModal').style.display='flex';
});
$('openAbout').addEventListener('click', ()=> { menuModal.style.display='none'; window.location.href = 'about.html'; });
$('openSettings').addEventListener('click', ()=> {
  menuModal.style.display='none';
  // toggle light/dark
  const mode = localStorage.getItem('NH_MODE') || 'light';
  const newMode = mode==='light' ? 'dark' : 'light';
  if(newMode==='dark'){
    document.documentElement.style.setProperty('--bg','#071418');
    document.documentElement.style.setProperty('--card','#0b1b1a');
    document.documentElement.style.setProperty('--muted','#dff6ec');
    localStorage.setItem('NH_MODE','dark');
  } else {
    document.documentElement.style.setProperty('--bg','#f6fff6');
    document.documentElement.style.setProperty('--card','#ffffff');
    document.documentElement.style.setProperty('--muted','#234e3a');
    localStorage.setItem('NH_MODE','light');
  }
  // ‚úÖ replaced alert with toast
  showToast('Theme set to ' + newMode, 'info');
});
$('openContact').addEventListener('click', ()=> {
  const msg = encodeURIComponent('Hello Nature Heals, I need help.');
  window.open('https://wa.me/15813419686?text=' + msg, '_blank');
});

/* close modals */
document.querySelectorAll('.closeModal').forEach(b=>b.addEventListener('click', ()=> { document.querySelectorAll('.overlay').forEach(o=>o.style.display='none'); }));

/* ========== Signup / Signin (localStorage-based) ========== */
// pick profile in signup
$('pickProfile').addEventListener('click', ()=> $('profileFile').click());
$('profileFile').addEventListener('change', (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const r = new FileReader();
  r.onload = ()=>{ $('signupPreview').src = r.result; $('signupPreview').style.display = 'block'; $('signupPreview').dataset.data = r.result; };
  r.readAsDataURL(file);
});

$('toggleSignupPass').addEventListener('click', ()=>{
  const p = $('signupPassword');
  p.type = p.type==='password' ? 'text' : 'password';
  $('toggleSignupPass').textContent = p.type==='password' ? 'Show' : 'Hide';
});

$('doSignup').addEventListener('click', ()=>{
  const username = $('signupUsername').value.trim();
  const email = $('signupEmail').value.trim();
  const pw = $('signupPassword').value;
  const pet = $('signupPet').value.trim();
  const pic = $('signupPreview').dataset?.data || null;
  if(!email || !pw){
    // ‚úÖ replaced alert with popup
    showPopup('Missing details','Please provide email and password.','warning');
    return;
  }
  // save locally as a simple user store
  const usersLocal = JSON.parse(localStorage.getItem('NH_LOCAL_USERS') || '[]');
  if(usersLocal.find(u=>u.email===email)){
    // ‚úÖ replaced alert with popup
    showPopup('Email exists','Email already exists. Please sign in.','warning');
    return;
  }
  usersLocal.push({email, username, password:pw, pet, profilePicDataURL:pic});
  localStorage.setItem('NH_LOCAL_USERS', JSON.stringify(usersLocal));
  currentUser = {email, username, profilePicDataURL: pic, pet};
  saveUser();
  $('signupModal').style.display='none';
  updateCartUI();
  // ‚úÖ replaced alert with centered popup success
  showPopup('Account Created','You are now signed in locally.','success');
});

$('toggleSigninPass').addEventListener('click', ()=>{
  const p = $('signinPassword');
  p.type = p.type==='password' ? 'text' : 'password';
  $('toggleSigninPass').textContent = p.type==='password' ? 'Show' : 'Hide';
});

$('doSignin').addEventListener('click', ()=>{
  const email = $('signinEmail').value.trim();
  const pw = $('signinPassword').value;
  const usersLocal = JSON.parse(localStorage.getItem('NH_LOCAL_USERS') || '[]');
  const u = usersLocal.find(x=>x.email===email && x.password===pw);
  if(!u){
    // ‚úÖ replaced alert with popup error
    showPopup('Login Failed','Invalid credentials','error');
    return;
  }
  currentUser = {email:u.email, username:u.username, profilePicDataURL:u.profilePicDataURL, pet:u.pet};
  saveUser();
  $('signinModal').style.display='none';
  if(currentUser.profilePicDataURL) profileImgEl.src = currentUser.profilePicDataURL;
  // ‚úÖ replaced alert with toast
  showToast('Signed in as ' + (u.username || u.email), 'success');
});

// forgot flow (pet name)
$('forgotPass').addEventListener('click', ()=>{
  $('signinModal').style.display='none';
  $('forgotModal').style.display='flex';
});
$('cancelPet').addEventListener('click', ()=> $('forgotModal').style.display='none');
$('submitPet').addEventListener('click', ()=>{
  const pet = $('petNameInput').value.trim();
  const usersLocal = JSON.parse(localStorage.getItem('NH_LOCAL_USERS') || '[]');
  const u = usersLocal.find(x=>x.pet && x.pet.toLowerCase()===pet.toLowerCase());
  if(!u){
    // ‚úÖ replaced alert with popup
    showPopup('Not found','No user found with that pet name','error');
    return;
  }
  // allow password change: show pw change modal
  $('forgotModal').style.display='none';
  $('pwChangeModal').style.display='flex';
  $('pwChangeModal').dataset.target = u.email;
});
$('doChangePw').addEventListener('click', ()=>{
  const newpw = $('newPassword').value;
  const target = $('pwChangeModal').dataset.target;
  if(!newpw){ $('pwMsg').textContent = 'Please provide a new password.'; return; }
  const usersLocal = JSON.parse(localStorage.getItem('NH_LOCAL_USERS') || '[]');
  const idx = usersLocal.findIndex(x=>x.email===target);
  if(idx>-1){ usersLocal[idx].password = newpw; localStorage.setItem('NH_LOCAL_USERS', JSON.stringify(usersLocal)); $('pwMsg').textContent='Password changed successfully.'; setTimeout(()=>{$('pwChangeModal').style.display='none';},800);
    // ‚úÖ added toast to show success
    showToast('Password changed successfully','success');
  }
});

/* ========== Country picker (short list; paste full list if you want) ========== */
const COUNTRIES = [
  {code:'NG', name:'Nigeria', flag:'üá≥üá¨'}, {code:'US', name:'United States', flag:'üá∫üá∏'},
  {code:'GB', name:'United Kingdom', flag:'üá¨üáß'}, {code:'CA', name:'Canada', flag:'üá®üá¶'},
  {code:'IN', name:'India', flag:'üáÆüá≥'}, {code:'FR', name:'France', flag:'üá´üá∑'}
];
function openCountryPicker(){
  $('countryModal').style.display='flex';
  const list = $('countryList'); list.innerHTML='';
  COUNTRIES.forEach(c=>{
    const row = document.createElement('div');
    row.style.padding='8px'; row.style.cursor='pointer'; row.style.display='flex'; row.style.gap='8px'; row.style.alignItems='center';
    row.innerHTML = `<div style="font-size:20px">${c.flag}</div><div style="flex:1">${c.name}</div>`;
    row.addEventListener('click', ()=>{ localStorage.setItem(LS_COUNTRY, JSON.stringify(c)); $('selectedFlag').textContent = c.flag; $('selectedCountry').textContent = c.name; $('countryModal').style.display='none'; });
    list.appendChild(row);
  });
}
$('countryBtn').addEventListener('click', openCountryPicker);
document.querySelectorAll('#countryModal .closeModal').forEach(b=>b.addEventListener('click', ()=> $('countryModal').style.display='none'));
const savedCountry = JSON.parse(localStorage.getItem(LS_COUNTRY) || 'null');
if(savedCountry){ $('selectedFlag').textContent = savedCountry.flag; $('selectedCountry').textContent = savedCountry.name; }

/* ========== Cart UI & actions (localStorage) ========== */
$('cartBtn').addEventListener('click', ()=> {
  $('cartModal').style.display='flex';
  renderCartItems();
});
function renderCartItems(){
  const container = $('cartItems'); container.innerHTML = '';
  if(cart.length===0){ container.innerHTML = '<div style="padding:12px;color:#666">Your cart is empty.</div>'; return; }
  cart.forEach((item, idx)=>{
    const row = document.createElement('div');
    row.style.display='flex'; row.style.alignItems='center'; row.style.gap='8px'; row.style.padding='8px 0'; row.style.borderBottom='1px solid rgba(0,0,0,0.04)';
    row.innerHTML = `<div style="flex:1"><div style="font-weight:800">${item.name}</div><div style="color:#666">‚Ç¶${Number(item.price).toFixed(2)}</div></div><button data-idx="${idx}" class="btn removeItem" style="background:#ef4444;color:#fff">Remove</button>`;
    container.appendChild(row);
  });
}
document.addEventListener('click', (e)=>{
  if(e.target.classList.contains('add')){
    const id = e.target.dataset.id;
    // find product in current snapshot
    const found = productsSnapshot.find(d => d.id === id);
    if(!found){
      // ‚úÖ replaced alert with popup
      showPopup('Product unavailable','Product not available','error');
      return;
    }
    cart.push({id:found.id, name: found.data.name, price: found.data.price});
    saveCart();
    // ‚úÖ replaced alert with toast
    showToast(found.data.name + ' added to cart üõí', 'success');
  }
  if(e.target.classList.contains('buy')){
    const name = e.target.dataset.name;
    const email = currentUser?.email || 'guest@example.com';
    const waMsg = encodeURIComponent(`Hello Nature Heals, I want to buy "${name}". My email: ${email}. How do I make payment?`);
    window.open(`https://wa.me/15813419686?text=${waMsg}`, '_blank');
  }
  if(e.target.classList.contains('removeItem')){
    const idx = Number(e.target.dataset.idx);
    cart.splice(idx,1); saveCart(); renderCartItems();
  }
});

/* cart actions */
$('clearCart').addEventListener('click', ()=>{ cart=[]; saveCart(); renderCartItems(); });
$('checkoutBtn').addEventListener('click', ()=>{
  if(cart.length===0){
    // ‚úÖ replaced alert with popup
    showPopup('Cart empty','Your cart is empty','info');
    return;
  }
  const names = cart.map(i=>i.name).join(', ');
  const email = currentUser?.email || 'guest@example.com';
  const wa = encodeURIComponent(`Hello Nature Heals, I want to checkout: ${names}. My email: ${email}. How do I pay?`);
  window.open(`https://wa.me/15813419686?text=${wa}`, '_blank');
});

/* ========== small UX: close overlays when clicking outside ========= */
document.querySelectorAll('.overlay').forEach(ov => {
  ov.addEventListener('click', (e) => { if(e.target === ov) ov.style.display='none'; });
});

/* ========== Finished init UI state ========== */
updateCartUI();
</script>
</body>
</html>
